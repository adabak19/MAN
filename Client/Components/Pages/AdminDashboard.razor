@page "/dashboard"
@using MAN.Shared.Interfaces
@inject IBookReadService BookReadService
@inject IBookService BookService
@inject IProfileService ProfileService
@inject NavigationManager Navigation

<h3>Dashboard</h3>

@if (isLoading)
{
    <p>Loading data...</p>
}
else
{
    <div class="dashboard-container">
        <div class="dashboard-card" @onclick="NavigateToActiveLoans">
            <h4>Active Loans</h4>
            <p>@activeLoansCount</p>
        </div>
        <div class="dashboard-card" @onclick="NavigateToBooks">
            <h4>Books</h4>
            <p>@booksCount</p>
        </div>
        <div class="dashboard-card" @onclick="NavigateToUsers">
            <h4>Users</h4>
            <p>@usersCount</p>
        </div>
    </div>
}

@code {
    private int activeLoansCount = 0;
    private int booksCount = 0;
    private int usersCount = 0;
    private bool isLoading = true;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            isLoading = true;
            activeLoansCount = (await BookReadService.GetAllReading()).Count;
            booksCount = (await BookService.GetAllAsync()).Count;
            usersCount = (await ProfileService.GetAllAsync()).Count;
        }
        catch (Exception ex)
        {
            Console.WriteLine($"Error loading data: {ex.Message}");
        }
        finally
        {
            isLoading = false;
        }
    }

    private void NavigateToActiveLoans() => Navigation.NavigateTo("/activeLoans");
    private void NavigateToBooks() => Navigation.NavigateTo("/books");
    private void NavigateToUsers() => Navigation.NavigateTo("/adminUsers");
}
